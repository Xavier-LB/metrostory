<script lang="ts">
	import { goto, preloadData, pushState } from '$app/navigation';
	import { page } from '$app/stores';
	import Modal from '$lib/Modal.svelte';

	let selectedStation: string;

	const toggleModal = async (clickedGroupId: string) => {
		const href = `station/${clickedGroupId}`;

		console.log('href', href);
		// get result of `load` function
		const result = await preloadData(href);
		if (result.type === 'loaded' && result.status === 200) {
			pushState(href, { selected: { station: result.data.id } });
		} else {
			goto(href);
		}
	};

	function handleClick(event: MouseEvent) {
		if (event.currentTarget) {
			// Cast currentTarget to HTMLElement to access the id property
			const clickedGroupId = (event.currentTarget as HTMLElement).id;

			// Handle the click event for the SVG group
			console.log(`SVG group with id ${clickedGroupId} clicked!`);
			selectedStation = clickedGroupId;
			toggleModal(clickedGroupId);
			// Add your custom logic here
		}
	}

	function handleKeyPress(event: KeyboardEvent) {
		// Handle keyboard events (e.g., pressing Enter) for accessibility
		if (event.key === 'Enter' || event.key === ' ') {
			// handleClick(event);
		}
	}
	function handleMouseOver(event: MouseEvent) {
		const clickArea = (event.currentTarget as HTMLElement)?.querySelector(
			'#click-area'
		) as HTMLElement;
		clickArea.style.transition = 'fill-opacity 0.3s ease'; // Add transition style
		clickArea.setAttribute('fill-opacity', '0.5');
	}

	function handleMouseOut(event: MouseEvent) {
		const clickArea = (event.currentTarget as HTMLElement)?.querySelector(
			'#click-area'
		) as HTMLElement;
		clickArea.style.transition = 'fill-opacity 0.3s ease'; // Add transition style
		clickArea.setAttribute('fill-opacity', '0.0');
	}

	function handleFocus(event: FocusEvent) {
		const clickArea = (event.currentTarget as HTMLElement)?.querySelector(
			'#click-area'
		) as HTMLElement;
		clickArea.style.transition = 'fill-opacity 0.3s ease'; // Add transition style
		clickArea.setAttribute('fill-opacity', '0.5');
	}

	function handleBlur(event: FocusEvent) {
		const clickArea = (event.currentTarget as HTMLElement)?.querySelector(
			'#click-area'
		) as HTMLElement;
		clickArea.style.transition = 'fill-opacity 0.3s ease'; // Add transition style
		clickArea.setAttribute('fill-opacity', '0.0');
	}
</script>

{#if $page.state.selected}
	<Modal on:close={() => history.back()}>
		hello
		<!-- <CountryInfo data={$page.state.country} /> -->
	</Modal>
{/if}

<div class="flex px-5 pb-5">
	<svg
		width="100%"
		height="100%"
		viewBox="0 0 1697 1941"
		fill="none"
		xmlns="http://www.w3.org/2000/svg"
	>
		<g id="full">
			<g id="lines">
				<path
					id="L6"
					d="M446 1003L475.179 974.654C478.912 971.028 483.911 969 489.115 969L721.716 969C727.02 969 732.107 966.893 735.858 963.142L789.142 909.858C792.893 906.107 797.98 904 803.284 904L1225 904C1236.05 904 1245 895.046 1245 884L1245 530.284C1245 524.98 1242.89 519.893 1239.14 516.142L1202 479"
					stroke="#9A3488"
					stroke-width="10"
				/>
				<path
					id="L5"
					d="M1382 1341L1149.83 1107.85C1146.1 1104.1 1144 1099.03 1144 1093.74L1144 969.284C1144 963.98 1141.89 958.893 1138.14 955.142L1072.86 889.858C1069.11 886.107 1067 881.02 1067 875.716L1067 638.284C1067 632.98 1064.89 627.893 1061.14 624.142L1008.86 571.858C1005.11 568.107 1000.02 566 994.716 566L590.284 566C584.98 566 579.893 563.893 576.142 560.142L551.858 535.858C548.107 532.107 543.02 530 537.716 530L154 530C142.954 530 134 538.954 134 550L134 955.716C134 961.02 131.893 966.107 128.142 969.858L12.8578 1085.14C9.10709 1088.89 6.99995 1093.98 6.99995 1099.28L7 1301"
					stroke="#179859"
					stroke-width="10"
				/>
				<path
					id="L4A"
					d="M872 1445L1178.72 1445C1184.02 1445 1189.11 1442.89 1192.86 1439.14L1384 1248"
					stroke="#0471B9"
					stroke-width="10"
				/>
				<path
					id="L4"
					d="M1241 442L1426.14 627.142C1429.89 630.893 1432 635.98 1432 641.284L1432 1191.72C1432 1197.02 1429.89 1202.11 1426.14 1205.86L1383.86 1248.14C1380.11 1251.89 1378 1256.98 1378 1262.28L1378 1328.72C1378 1334.02 1380.11 1339.11 1383.86 1342.86L1426.14 1385.14C1429.89 1388.89 1432 1393.98 1432 1399.28L1432 1941"
					stroke="#2D2B73"
					stroke-width="10"
				/>
				<path
					id="L3"
					d="M445 108L671.716 108C677.02 108 682.107 110.107 685.858 113.858L866.142 294.142C869.893 297.893 872 302.98 872 308.284L872 792.5C872 803.546 880.954 812.5 892 812.5L1526 812.5"
					stroke="#6B2C15"
					stroke-width="10"
				/>
				<path
					id="L2"
					d="M972 135V476C972 487.046 963.046 496 952 496H796C784.954 496 776 504.954 776 516V851.716C776 857.02 778.107 862.107 781.858 865.858L866.142 950.142C869.893 953.893 872 958.98 872 964.284V1781"
					stroke="#FAB515"
					stroke-width="10"
				/>
				<path
					id="L1"
					fill-rule="evenodd"
					clip-rule="evenodd"
					d="M1570 370C1570 367.239 1567.76 365 1565 365C1562.24 365 1560 367.239 1560 370V375.998L1313.11 376C1305.95 376 1299.08 378.845 1294.02 383.908L1015.91 662.021C1012.72 665.209 1008.4 667 1003.89 667H256C246.611 667 239 659.389 239 650L239 530H229L229 650C229 664.912 241.088 677 256 677H1003.89C1011.05 677 1017.92 674.155 1022.98 669.092L1301.09 390.979C1304.28 387.791 1308.6 386 1313.11 386L1560 385.999V392C1560 394.761 1562.24 397 1565 397C1567.76 397 1570 394.761 1570 392V370Z"
					fill="#D60D27"
				/>
			</g>
			<g id="stations-line-1">
				<g id="LD">
					<g
						id="LD"
						on:click={handleClick}
						on:keydown={handleKeyPress}
						on:mouseover={handleMouseOver}
						on:mouseout={handleMouseOut}
						on:focus={handleFocus}
						on:blur={handleBlur}
						tabindex="-1"
						role="button"
						aria-label="Clickable Element"
						class="focus:outline-none"
					>
						<path
							class="-z-50"
							id="LD-name"
							d="M1577.22 376.484H1579.62V385.93H1585.33V388H1577.22V376.484ZM1594.24 380.562C1594.96 381.464 1595.32 382.529 1595.32 383.758C1595.32 385.008 1594.96 386.078 1594.24 386.969C1593.52 387.854 1592.43 388.297 1590.97 388.297C1589.5 388.297 1588.41 387.854 1587.69 386.969C1586.98 386.078 1586.62 385.008 1586.62 383.758C1586.62 382.529 1586.98 381.464 1587.69 380.562C1588.41 379.661 1589.5 379.211 1590.97 379.211C1592.43 379.211 1593.52 379.661 1594.24 380.562ZM1590.96 381.094C1590.31 381.094 1589.81 381.326 1589.45 381.789C1589.1 382.247 1588.93 382.904 1588.93 383.758C1588.93 384.612 1589.1 385.271 1589.45 385.734C1589.81 386.198 1590.31 386.43 1590.96 386.43C1591.61 386.43 1592.11 386.198 1592.46 385.734C1592.81 385.271 1592.98 384.612 1592.98 383.758C1592.98 382.904 1592.81 382.247 1592.46 381.789C1592.11 381.326 1591.61 381.094 1590.96 381.094ZM1603.11 379.875C1603.78 380.302 1604.16 381.036 1604.26 382.078H1602.03C1602 381.792 1601.92 381.565 1601.79 381.398C1601.54 381.096 1601.13 380.945 1600.54 380.945C1600.05 380.945 1599.71 381.021 1599.5 381.172C1599.3 381.323 1599.19 381.5 1599.19 381.703C1599.19 381.958 1599.3 382.143 1599.52 382.258C1599.74 382.378 1600.51 382.583 1601.84 382.875C1602.73 383.083 1603.39 383.398 1603.84 383.82C1604.27 384.247 1604.49 384.781 1604.49 385.422C1604.49 386.266 1604.18 386.956 1603.55 387.492C1602.92 388.023 1601.95 388.289 1600.64 388.289C1599.3 388.289 1598.31 388.008 1597.67 387.445C1597.04 386.878 1596.72 386.156 1596.72 385.281H1598.98C1599.02 385.677 1599.12 385.958 1599.28 386.125C1599.56 386.422 1600.07 386.57 1600.81 386.57C1601.25 386.57 1601.6 386.505 1601.85 386.375C1602.11 386.245 1602.24 386.049 1602.24 385.789C1602.24 385.539 1602.14 385.349 1601.93 385.219C1601.72 385.089 1600.95 384.865 1599.61 384.547C1598.65 384.307 1597.97 384.008 1597.57 383.648C1597.17 383.294 1596.98 382.784 1596.98 382.117C1596.98 381.331 1597.28 380.656 1597.9 380.094C1598.52 379.526 1599.39 379.242 1600.51 379.242C1601.57 379.242 1602.44 379.453 1603.11 379.875ZM1616.38 388H1611.42V376.484H1616.38C1617.1 376.495 1617.69 376.578 1618.16 376.734C1618.97 377 1619.62 377.487 1620.12 378.195C1620.52 378.768 1620.8 379.388 1620.94 380.055C1621.09 380.721 1621.16 381.357 1621.16 381.961C1621.16 383.492 1620.86 384.789 1620.24 385.852C1619.41 387.284 1618.12 388 1616.38 388ZM1618.17 379.422C1617.8 378.797 1617.07 378.484 1615.98 378.484H1613.76V386H1615.98C1617.11 386 1617.9 385.44 1618.35 384.32C1618.6 383.706 1618.72 382.974 1618.72 382.125C1618.72 380.953 1618.54 380.052 1618.17 379.422ZM1630.22 380.562C1630.94 381.464 1631.3 382.529 1631.3 383.758C1631.3 385.008 1630.94 386.078 1630.22 386.969C1629.51 387.854 1628.42 388.297 1626.95 388.297C1625.49 388.297 1624.4 387.854 1623.68 386.969C1622.96 386.078 1622.6 385.008 1622.6 383.758C1622.6 382.529 1622.96 381.464 1623.68 380.562C1624.4 379.661 1625.49 379.211 1626.95 379.211C1628.42 379.211 1629.51 379.661 1630.22 380.562ZM1626.94 381.094C1626.29 381.094 1625.79 381.326 1625.44 381.789C1625.09 382.247 1624.91 382.904 1624.91 383.758C1624.91 384.612 1625.09 385.271 1625.44 385.734C1625.79 386.198 1626.29 386.43 1626.94 386.43C1627.59 386.43 1628.09 386.198 1628.44 385.734C1628.79 385.271 1628.97 384.612 1628.97 383.758C1628.97 382.904 1628.79 382.247 1628.44 381.789C1628.09 381.326 1627.59 381.094 1626.94 381.094ZM1638.01 381.828C1637.82 381.417 1637.45 381.211 1636.9 381.211C1636.27 381.211 1635.84 381.417 1635.62 381.828C1635.5 382.062 1635.44 382.411 1635.44 382.875V388H1633.19V379.5H1635.35V380.742C1635.63 380.299 1635.89 379.984 1636.13 379.797C1636.56 379.464 1637.12 379.297 1637.81 379.297C1638.46 379.297 1638.99 379.44 1639.39 379.727C1639.71 379.992 1639.96 380.333 1640.12 380.75C1640.41 380.25 1640.78 379.883 1641.21 379.648C1641.67 379.414 1642.18 379.297 1642.74 379.297C1643.12 379.297 1643.49 379.37 1643.85 379.516C1644.21 379.661 1644.54 379.917 1644.84 380.281C1645.08 380.578 1645.24 380.943 1645.33 381.375C1645.38 381.661 1645.4 382.081 1645.4 382.633L1645.39 388H1643.11V382.578C1643.11 382.255 1643.06 381.99 1642.95 381.781C1642.75 381.385 1642.39 381.188 1641.86 381.188C1641.24 381.188 1640.82 381.443 1640.58 381.953C1640.46 382.224 1640.4 382.549 1640.4 382.93V388H1638.16V382.93C1638.16 382.424 1638.11 382.057 1638.01 381.828ZM1650.07 379.484V388H1647.81V379.484H1650.07ZM1650.07 376.414V378.469H1647.81V376.414H1650.07ZM1656.56 381.133C1655.8 381.133 1655.29 381.453 1655.01 382.094C1654.86 382.432 1654.79 382.865 1654.79 383.391V388H1652.57V379.5H1654.72V380.742C1655 380.305 1655.27 379.99 1655.53 379.797C1655.99 379.453 1656.57 379.281 1657.27 379.281C1658.15 379.281 1658.87 379.513 1659.43 379.977C1659.99 380.435 1660.27 381.198 1660.27 382.266V388H1657.99V382.82C1657.99 382.372 1657.93 382.029 1657.81 381.789C1657.59 381.352 1657.17 381.133 1656.56 381.133ZM1664.94 379.484V388H1662.68V379.484H1664.94ZM1664.94 376.414V378.469H1662.68V376.414H1664.94ZM1674.79 382.539H1672.51C1672.47 382.221 1672.36 381.935 1672.19 381.68C1671.94 381.336 1671.55 381.164 1671.03 381.164C1670.28 381.164 1669.77 381.536 1669.49 382.281C1669.34 382.677 1669.27 383.203 1669.27 383.859C1669.27 384.484 1669.34 384.987 1669.49 385.367C1669.75 386.076 1670.25 386.43 1670.99 386.43C1671.51 386.43 1671.88 386.289 1672.1 386.008C1672.32 385.727 1672.45 385.362 1672.5 384.914H1674.77C1674.72 385.591 1674.47 386.232 1674.04 386.836C1673.34 387.81 1672.3 388.297 1670.93 388.297C1669.56 388.297 1668.56 387.891 1667.91 387.078C1667.27 386.266 1666.94 385.211 1666.94 383.914C1666.94 382.451 1667.3 381.312 1668.01 380.5C1668.73 379.688 1669.71 379.281 1670.97 379.281C1672.03 379.281 1672.91 379.521 1673.58 380C1674.27 380.479 1674.67 381.326 1674.79 382.539ZM1683.75 380.562C1684.47 381.464 1684.83 382.529 1684.83 383.758C1684.83 385.008 1684.47 386.078 1683.75 386.969C1683.04 387.854 1681.94 388.297 1680.48 388.297C1679.02 388.297 1677.93 387.854 1677.21 386.969C1676.49 386.078 1676.13 385.008 1676.13 383.758C1676.13 382.529 1676.49 381.464 1677.21 380.562C1677.93 379.661 1679.02 379.211 1680.48 379.211C1681.94 379.211 1683.04 379.661 1683.75 380.562ZM1680.47 381.094C1679.82 381.094 1679.32 381.326 1678.97 381.789C1678.62 382.247 1678.44 382.904 1678.44 383.758C1678.44 384.612 1678.62 385.271 1678.97 385.734C1679.32 386.198 1679.82 386.43 1680.47 386.43C1681.12 386.43 1681.62 386.198 1681.97 385.734C1682.32 385.271 1682.5 384.612 1682.5 383.758C1682.5 382.904 1682.32 382.247 1681.97 381.789C1681.62 381.326 1681.12 381.094 1680.47 381.094ZM1692.62 379.875C1693.29 380.302 1693.67 381.036 1693.77 382.078H1691.54C1691.51 381.792 1691.43 381.565 1691.3 381.398C1691.06 381.096 1690.64 380.945 1690.05 380.945C1689.57 380.945 1689.22 381.021 1689.01 381.172C1688.81 381.323 1688.71 381.5 1688.71 381.703C1688.71 381.958 1688.82 382.143 1689.04 382.258C1689.25 382.378 1690.03 382.583 1691.36 382.875C1692.24 383.083 1692.91 383.398 1693.35 383.82C1693.79 384.247 1694 384.781 1694 385.422C1694 386.266 1693.69 386.956 1693.06 387.492C1692.43 388.023 1691.46 388.289 1690.15 388.289C1688.81 388.289 1687.82 388.008 1687.18 387.445C1686.55 386.878 1686.23 386.156 1686.23 385.281H1688.49C1688.54 385.677 1688.64 385.958 1688.79 386.125C1689.07 386.422 1689.58 386.57 1690.32 386.57C1690.76 386.57 1691.11 386.505 1691.36 386.375C1691.62 386.245 1691.75 386.049 1691.75 385.789C1691.75 385.539 1691.65 385.349 1691.44 385.219C1691.23 385.089 1690.46 384.865 1689.12 384.547C1688.16 384.307 1687.48 384.008 1687.08 383.648C1686.69 383.294 1686.49 382.784 1686.49 382.117C1686.49 381.331 1686.8 380.656 1687.41 380.094C1688.03 379.526 1688.9 379.242 1690.02 379.242C1691.08 379.242 1691.95 379.453 1692.62 379.875Z"
							fill="black"
						/>
						<circle id="Ellipse 1" cx="1565" cy="381" r="4" fill="white" />
						<circle id="click-area" cx="1565" cy="381" r="25" fill="#D9D9D9" fill-opacity="0.0" />
						<rect
							id="click-area"
							x="1570"
							y="356"
							width="131"
							height="50"
							fill="#D9D9D9"
							fill-opacity="0.0"
						/>
					</g>
				</g>
				<g
					id="33-HM"
					on:click={handleClick}
					on:keydown={handleKeyPress}
					on:mouseover={handleMouseOver}
					on:mouseout={handleMouseOut}
					on:focus={handleFocus}
					on:blur={handleBlur}
					tabindex="-1"
					role="button"
					aria-label="Clickable Element"
					class="focus:outline-none"
				>
					<circle id="Ellipse 1_2" cx="1506" cy="381" r="4" fill="white" />
					<circle id="click-area" cx="1506" cy="381" r="25" fill="#D9D9D9" fill-opacity="0.0" />
				</g>
				<g id="58-MQ">
					<circle id="Ellipse 1_3" cx="1447" cy="381" r="4" fill="white" />
				</g>
				<g id="27-EM">
					<circle id="Ellipse 1_4" cx="1387" cy="381" r="4" fill="white" />
				</g>
				<g id="3-AL">
					<circle id="Ellipse 1_5" cx="1325" cy="381" r="4" fill="white" />
				</g>
				<g id="32-GO">
					<circle id="Ellipse 1_6" cx="1277" cy="408" r="4" fill="white" />
				</g>
				<g id="93-TB">
					<circle
						id="Ellipse 1_7"
						cx="1242"
						cy="443"
						r="7.5"
						fill="white"
						stroke="black"
						stroke-width="5"
					/>
				</g>
				<g id="41-LEN">
					<circle
						id="Ellipse 1_8"
						cx="1203"
						cy="482"
						r="7.5"
						fill="white"
						stroke="black"
						stroke-width="5"
					/>
				</g>
				<g id="74-PV">
					<circle id="Ellipse 1_9" cx="1162" cy="523" r="4" fill="white" />
				</g>
				<g id="57-MM">
					<circle id="Ellipse 1_10" cx="1129" cy="556" r="4" fill="white" />
				</g>
				<g id="85-SA">
					<circle id="Ellipse 1_11" cx="1095" cy="590" r="4" fill="white" />
				</g>
				<g id="6-BA">
					<circle
						id="Ellipse 1_12"
						cx="1061"
						cy="624"
						r="7.5"
						fill="white"
						stroke="black"
						stroke-width="5"
					/>
				</g>
				<g id="96-UC">
					<circle id="Ellipse 1_13" cx="1010" cy="671" r="4" fill="white" />
				</g>
				<g id="89-SL">
					<circle id="Ellipse 1_14" cx="950" cy="672" r="4" fill="white" />
				</g>
				<g id="15-CH">
					<circle
						id="Ellipse 1_15"
						cx="873"
						cy="672"
						r="7.5"
						fill="white"
						stroke="black"
						stroke-width="5"
					/>
				</g>
				<g id="46-LM">
					<circle id="Ellipse 1_16" cx="822" cy="672" r="4" fill="white" />
				</g>
				<g id="44-LH">
					<circle
						id="Ellipse 1_17"
						cx="776"
						cy="672"
						r="7.5"
						fill="white"
						stroke="black"
						stroke-width="5"
					/>
				</g>
				<g id="83-RP">
					<circle id="Ellipse 1_18" cx="715" cy="672" r="4" fill="white" />
				</g>
				<g id="38-LA">
					<circle id="Ellipse 1_19" cx="647" cy="672" r="4" fill="white" />
				</g>
				<g id="26-EL">
					<circle id="Ellipse 1_20" cx="577" cy="672" r="4" fill="white" />
				</g>
				<g id="97-US">
					<circle id="Ellipse 1_21" cx="511" cy="672" r="4" fill="white" />
				</g>
				<g id="2-AH">
					<circle id="Ellipse 1_22" cx="444" cy="672" r="4" fill="white" />
				</g>
				<g id="23-EC">
					<circle id="Ellipse 1_23" cx="376" cy="672" r="4" fill="white" />
				</g>
				<g id="50-LR">
					<circle id="Ellipse 1_24" cx="309" cy="672" r="4" fill="white" />
				</g>
				<g id="67-PJ">
					<circle id="Ellipse 1_25" cx="245" cy="669" r="4" fill="white" />
				</g>
				<g id="60-NP">
					<circle id="Ellipse 1_26" cx="234" cy="599" r="4" fill="white" />
				</g>
				<g id="91-SP">
					<circle
						id="Ellipse 1_27"
						cx="234"
						cy="530"
						r="7.5"
						fill="white"
						stroke="black"
						stroke-width="5"
					/>
				</g>
			</g>
		</g>
	</svg>
</div>
